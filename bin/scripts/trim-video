#!/bin/bash

# 用法检查
if [ "$#" -ne 4 ]; then
    echo "Usage: $0 <start_time> <duration> <input_file> <output_file>"
    exit 1
fi

START_TIME="$1"
DURATION="$2"
INPUT_FILE="$3"
OUTPUT_FILE="$4"

# 检查输入文件是否存在
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file '$INPUT_FILE' does not exist."
    exit 2
fi

# 使用 ffmpeg 截取视频
ffmpeg -y -nostdin -ss "$START_TIME" -i "$INPUT_FILE" -t "$DURATION" -c copy "$OUTPUT_FILE"

if [ $? -ne 0 ]; then
    echo "Error: ffmpeg failed."
    exit 3
fi

# 使用 exiftool 复制元数据
exiftool -overwrite_original_in_place -TagsFromFile "$INPUT_FILE" "$OUTPUT_FILE"

if [ $? -ne 0 ]; then
    echo "Error: exiftool failed."
    exit 4
fi

echo "Video successfully trimmed and metadata copied to '$OUTPUT_FILE'."

